---
import { ClientRouter } from 'astro:transitions';
---
<head>
	<meta name="viewport" content="width=device-width,initial-scale=1.0">

</head>
<header transition:persist="none">
	<ClientRouter />
	<a href="/" class="logo">
		<img src="/luglogo.png" alt="logo">
		<span>The LUGVITC Blog</span>
	</a>
	<nav>
		<a href="/">cd ~</a>
		<a href="https://www.lugvitc.net">cd /</a>
		<a href="https://lugvitc.net/#/contact">ping port:80</a>
	</nav>
	<button id="toggle-theme" aria-label="Toggle theme"><img src="/Sun.svg" alt="Toggle theme"></button>
</header>

<script is:inline>
	const getTheme = () => {
		if (localStorage.getItem("theme")) {
			return localStorage.getItem("theme");
		}
		if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
			return "dark";
		}
		return "light";
	};

	const applyTheme = (theme) => {
		document.documentElement.classList.toggle("dark", theme === "dark");
	};

	const updateIcon = (theme) => {
		const icon = document.querySelector("#toggle-theme img");
		if (icon) {
			icon.src = theme === "dark" ? "/Sun.svg" : "/Moon.svg";
		}
	};

	const handleToggleClick = () => {
		document.documentElement.classList.add("disable-transitions");

		const isDark = document.documentElement.classList.toggle("dark");
		const theme = isDark ? "dark" : "light";

		localStorage.setItem("theme", theme);
		updateIcon(theme);

		window.setTimeout(() => {
			document.documentElement.classList.remove("disable-transitions");
		}, 0);
	};

	const theme = getTheme();
	applyTheme(theme);
	updateIcon(theme);
	localStorage.setItem("theme", theme);

	const attachToggle = () => {
		const btn = document.getElementById("toggle-theme");
		if (btn) {
			btn.onclick = handleToggleClick;
		}
	};

	
	if (!window.themeListenersAttached) {
		document.addEventListener("astro:after-swap", () => {
			applyTheme(getTheme());
			updateIcon(getTheme());
	});

	document.addEventListener("astro:page-load", () => {
			attachToggle();
			applyTheme(getTheme());
	});
	
	window.themeListenersAttached = true;
	}
</script>

<style>
	header {
		display:flex;
		align-items: center;
		gap: 2rem;
		padding:0.1rem 0.5rem;
		border-bottom:4px solid var(--header-border);
		color: white;
		background: var(--header-bg);
	}

	.logo {
		display: flex;
		align-items: center;
		text-decoration:none;
		color:inherit;
		padding: 4px;
	}
	.logo img {
		height: 80px;
		width: auto;
	}

	.logo span {
		font-weight: 400;
		letter-spacing: 0.05em;
		line-height: 1;
		border:2px solid var(--color-border);
		padding:12px;
		background:var(--gray);
		box-shadow: 6px 6px var(--box-shadow);
	}

	nav {
		width: auto;
		display:flex;
		gap:2rem;
		margin-left: auto;
	}

	nav a {
		text-decoration:none;
		color: inherit;
		padding: 0.5rem 2.5rem;
		box-shadow: 6px 6px var(--box-shadow);
	}

	nav a:nth-child(1) {
		background: var(--color-orange); 
	}

	nav a:nth-child(2) {
		background: var(--color-blue); 
	}

	nav a:nth-child(3) {
		background: var(--color-green); 
	}

	#toggle-theme {
		display:flex;
		align-items:center;
		justify-content: center;
		padding:0.5rem 0.5rem;
		background: var(--color-orange);
		box-shadow: 6px 6px var(--box-shadow);
		margin-right: 12px;
		border: none;
		border-radius: 0;
		cursor: pointer;
	}

	#toggle-theme img {
		width: 32px;
		height: 32px;
	}

	header nav a,
	#toggle-theme {
	transition:
		transform 0.15s ease-out,
		box-shadow 0.15s ease-out;
	}

	header nav a:hover, #toggle-theme:hover {
		transform: translate(1px, 1px);
		box-shadow: 4px 4px var(--box-shadow);
	}

	/*Mobile*/
	@media(max-width:600px){

		header{
			flex-direction: column;
			gap: 1.5rem;
		}
		.logo{
			align-self:flex-start;
			padding:10px;
		}
		.logo span{
			padding:10px;
			font-size:0.95rem;
		}
		nav{
			flex-direction:column;
			margin-left:0;
			gap:1.2rem;
			
		}
		nav a{
			max-width: 400px;
			margin :  0 auto;
			text-align: center;
			padding:0.6rem;
		}
		#toggle-theme{
			align-self:flex-end;
			margin-bottom: 10px;
		}
	}

	/*Tablet*/
	@media(max-width:950px){
		header{
			gap:0.8rem;
			padding:8px;
		}
		.logo{
			padding:20px;
		}
		.logo img{
			height:90px;
		}
		nav{
			gap:1.2rem;
		}
		nav a{
			padding: 0.15rem 0.65rem;
		}
		#toggle-theme{
			padding: 0.5rem;
		}
	}



</style>
